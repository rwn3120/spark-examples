{"paragraphs":[{"title":"Instructions","text":"%md \n1. start `netcat server` (!)\n2. set correct `host address` in `Start streaming` paragraph\n3. start query (run `Start streaming` paragraph)\n4. run SQL paragraphs\n5. publish some text via netcat server\n6. rerun SQL paragraphs\n7. stop query (run `Stop streaming` paragraph)","user":"anonymous","dateUpdated":"2018-11-01T11:32:04+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992934_-1708437287","id":"20181030-111213_1493553682","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T11:32:02+0000","dateFinished":"2018-11-01T11:32:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5928","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<ol>\n  <li>start <code>netcat server</code> (!)</li>\n  <li>set correct <code>host address</code> in <code>Start streaming</code> paragraph</li>\n  <li>start query (run <code>Start streaming</code> paragraph)</li>\n  <li>run SQL paragraphs</li>\n  <li>publish some text via netcat server</li>\n  <li>rerun SQL paragraphs</li>\n  <li>stop query (run <code>Stop streaming</code> paragraph)</li>\n</ol>\n</div>"}]}},{"title":"Start streaming","text":"%spark\nimport org.apache.spark.streaming._\nimport org.apache.spark.sql.streaming._\nimport spark.implicits._\n\n// open socket stream (connect to netcat server and retrieve all data)\nval socketStreamDf = spark.\n  readStream.\n  format(\"socket\").\n  option(\"host\", \"192.168.57.3\").\n  option(\"port\", 12345).\n  load\n\n// convert input stream to text\nval textDs = socketStreamDf.as[String] // [ binary data ] => [\"Hello World. Hello Spark.\"]\n\n// split text to words\nval wordsDs = textDs.flatMap(text => text.split(\" \")) // [\"Hello World\"] => [\"Hello\", \"World.\", \"Hello\", \"Spark.\"]\n\n// group words by their value\nval countDs = wordsDs.groupBy(\"value\").count    // [\"Hello\", World.\", \"Hello\", \"Spark.\" ] => [[\"Hello\" , 2], [\"World.\" , 1], [\"Spark\", 1]]\n\n// start the execution of the query\nval query = countDs.writeStream.                // write to output stream\n    format(\"memory\").                           // output is stored in memory as an in-memory table\n    queryName(\"wordcount\").                     // table name\n    outputMode(OutputMode.Complete()).          // use entire updated table (storage connector to decides how to handle writing of the entire table)\n    start()","user":"anonymous","dateUpdated":"2018-11-01T11:02:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992939_-1710361031","id":"20181029-214402_2117766316","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T09:57:09+0000","dateFinished":"2018-11-01T09:57:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5929"},{"title":"Top 10 words","text":"%sql select value, count from wordcount ORDER BY count DESC LIMIT 10\n","user":"anonymous","dateUpdated":"2018-11-01T11:32:01+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":7,"editorMode":"ace/mode/sql","editorHide":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":262,"optionOpen":false},"helium":{}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992939_-1710361031","id":"20181030-110916_1510165702","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T09:59:00+0000","dateFinished":"2018-11-01T09:59:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5930"},{"title":"Top 10 words","text":"%sql select value, count from wordcount ORDER BY count DESC LIMIT 10","user":"anonymous","dateUpdated":"2018-11-01T11:02:15+0000","config":{"lineNumbers":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":5,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":true,"results":{"0":{"graph":{"mode":"pieChart","height":276,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"value":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"value","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992939_-1710361031","id":"20181029-220011_497590678","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T09:59:05+0000","dateFinished":"2018-11-01T09:59:05+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5931"},{"title":"Is query alive?","text":"%spark query.isActive\n","user":"anonymous","dateUpdated":"2018-11-01T07:56:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992939_-1710361031","id":"20181030-061730_1829559647","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T06:16:57+0000","dateFinished":"2018-11-01T06:16:59+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5932"},{"title":"Stop query","text":"%spark\nquery.stop()\n","user":"anonymous","dateUpdated":"2018-11-01T07:56:34+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992940_-1712284776","id":"20181030-063303_2087051763","dateCreated":"2018-10-31T11:39:52+0000","dateStarted":"2018-11-01T07:56:30+0000","dateFinished":"2018-11-01T07:56:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5933"},{"text":"%spark\n","dateUpdated":"2018-10-31T11:39:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540985992940_-1712284776","id":"20181030-072209_1878640414","dateCreated":"2018-10-31T11:39:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5934"}],"name":"streaming-wordcount","id":"2DUQ3VXY2","angularObjects":{"2DW4GMKV4:shared_process":[],"2DVAY6HJA:shared_process":[],"2DWWWMYYD:shared_process":[],"2DUMGC4N6:shared_process":[],"2DVPRCRF8:shared_process":[],"2DUG1UCGJ:shared_process":[],"2DVV9DBRG:shared_process":[],"2DVEGK277:shared_process":[],"2DU2193PE:shared_process":[],"2DV14XFAE:shared_process":[],"2DWK7WUAU:shared_process":[],"2DWM7GEKN:shared_process":[],"2DU6DRYSE:shared_process":[],"2DU899EQ7:shared_process":[],"2DTUQGZWY:shared_process":[],"2DW1HP3HX:shared_process":[],"2DVAZT57G:shared_process":[],"2DWFKSHSZ:shared_process":[],"2DWDM98TX:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}