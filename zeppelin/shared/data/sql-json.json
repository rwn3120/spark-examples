{"paragraphs":[{"text":"%md # Run SQL over JSON file demo\n\nInstructions:\n1) run `ALL` paragraphs","user":"anonymous","dateUpdated":"2018-10-30T12:30:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540902588833_1451998487","id":"20181030-122948_314706387","dateCreated":"2018-10-30T12:29:48+0000","dateStarted":"2018-10-30T12:30:50+0000","dateFinished":"2018-10-30T12:30:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11281","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Run SQL over JSON file demo</h1>\n<p>Instructions:<br/>1) run <code>ALL</code> paragraphs</p>\n</div>"}]}},{"text":"%spark\nimport org.apache.commons.io.IOUtils\nimport org.apache.commons.lang.time.DateUtils\nimport java.net.URL\nimport java.nio.charset.Charset\nimport scala.collection.mutable\nimport java.sql.Timestamp\nimport java.util.{Calendar, Date}\nimport org.apache.spark.sql.types._\n\n// converts millis to timestamp\ndef timestamp(millis: Long): java.sql.Timestamp = new java.sql.Timestamp(millis)\n\n// download json\nval json = IOUtils.toString(\n      new URL(\"https://store.steampowered.com/stats/userdata.json\"),\n      Charset.forName(\"utf8\"))\n\n\n// load json\nval jsonDF = sqlContext.read.json(sc.parallelize(Seq(json)))\n\n// parse data from json\nval flattenedDF = jsonDF.withColumn(\"data\", explode($\"data\"))\n\n// parse date & users column from json\nval usersDF = flattened.map(row => {\n    val wrappedArray = row.getAs[mutable.WrappedArray[Long]](\"data\")\n    (wrappedArray(0), wrappedArray(1))\n}).toDF(\"date\", \"users\")\n\n// create view\nusersDF.toDF(\"date\", \"count\").createOrReplaceTempView(\"users\")","user":"anonymous","dateUpdated":"2018-10-30T12:29:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540847853929_233793070","id":"20181029-211733_1666090323","dateCreated":"2018-10-29T21:17:33+0000","dateStarted":"2018-10-30T12:28:19+0000","dateFinished":"2018-10-30T12:28:31+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11282"},{"text":"%md ## Results\n","user":"anonymous","dateUpdated":"2018-10-30T12:30:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540902625833_-16759920","id":"20181030-123025_2043870569","dateCreated":"2018-10-30T12:30:25+0000","dateStarted":"2018-10-30T12:30:35+0000","dateFinished":"2018-10-30T12:30:35+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11283"},{"text":"%sql\nSELECT date, count FROM users SORT BY date","user":"anonymous","dateUpdated":"2018-10-30T12:28:32+0000","config":{"colWidth":4,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"stackedAreaChart","height":234,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"date":"string","users":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"date","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540847888971_1134571417","id":"20181029-211808_1706492508","dateCreated":"2018-10-29T21:18:08+0000","dateStarted":"2018-10-30T12:28:32+0000","dateFinished":"2018-10-30T12:28:32+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11284"},{"text":"%sql\nSELECT MAX(count) AS MAX, MIN(count) AS MIN FROM users","user":"anonymous","dateUpdated":"2018-10-30T12:28:13+0000","config":{"colWidth":8,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":228,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"date":"string","users":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"pieChart":{}},"commonSetting":{},"keys":[],"groups":[],"values":[{"name":"MIN","index":1,"aggr":"sum"},{"name":"MAX","index":0,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540849172216_-1487747627","id":"20181029-213932_759363645","dateCreated":"2018-10-29T21:39:32+0000","dateStarted":"2018-10-30T12:28:00+0000","dateFinished":"2018-10-30T12:28:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11285"},{"text":"%sql\n","user":"anonymous","dateUpdated":"2018-10-29T21:52:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1540849979658_894315169","id":"20181029-215259_1931318843","dateCreated":"2018-10-29T21:52:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11286"}],"name":"sql-json","id":"2DVN8AR98","angularObjects":{"2DWBR4VCA:shared_process":[],"2DW2BS79V:shared_process":[],"2DU4TZ7XR:shared_process":[],"2DVQTZE24:shared_process":[],"2DVEAQVQC:shared_process":[],"2DW8BWFY5:shared_process":[],"2DUZUP2P4:shared_process":[],"2DUPANRAR:shared_process":[],"2DWNQ7UH7:shared_process":[],"2DTBXU8J8:shared_process":[],"2DU3VBSZH:shared_process":[],"2DTXHJ2HA:shared_process":[],"2DVU8AEWS:shared_process":[],"2DUSJ26M4:shared_process":[],"2DTW7U68Z:shared_process":[],"2DUGP5BXF:shared_process":[],"2DT7F45DX:shared_process":[],"2DWE5G4TC:shared_process":[],"2DVXKH843:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}